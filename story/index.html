<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã†ã¡ã®å­ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ï½œå¤§é˜ªã®ã‚µã‚¤ãƒ™ãƒªã‚¢ãƒ³å°‚é–€ãƒ–ãƒªãƒ¼ãƒ€ãƒ¼ï½œç¦æ¥½ã‚­ãƒ£ãƒƒãƒ†ãƒªãƒ¼</title>
  <meta name="description" content="ç¦æ¥½ã‚­ãƒ£ãƒƒãƒ†ãƒªãƒ¼ã‹ã‚‰ãŠè¿ãˆã—ãŸçŒ«ã¡ã‚ƒã‚“ã®å†™çœŸã¨AIæ–‡ç« ã§ã€ä¸–ç•Œã«1æšã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’ä½œã‚ã†ï¼Instagramãƒ»å°çº¢ä¹¦ãƒ»æœ‹å‹åœˆã«ã‚·ã‚§ã‚¢ã€‚">
  <meta name="keywords" content="çŒ«ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰,ã‚µã‚¤ãƒ™ãƒªã‚¢ãƒ³,å¤§é˜ª,ãƒ–ãƒªãƒ¼ãƒ€ãƒ¼,ç¦æ¥½ã‚­ãƒ£ãƒƒãƒ†ãƒªãƒ¼,çŒ«ãŠè¿ãˆè¨˜å¿µ,UGC,çŒ«å†™çœŸã‚«ãƒ¼ãƒ‰">
  <meta property="og:title" content="ã†ã¡ã®å­ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ï½œç¦æ¥½ã‚­ãƒ£ãƒƒãƒ†ãƒªãƒ¼">
  <meta property="og:description" content="ãŠè¿ãˆã—ãŸçŒ«ã¡ã‚ƒã‚“ã®å†™çœŸã¨AIæ–‡ç« ã§ã€ä¸–ç•Œã«1æšã®ã‚«ãƒ¼ãƒ‰ã‚’ä½œã‚ã†ï¼">
  <meta property="og:type" content="website">
  <meta property="og:image" content="/images/ogp.jpg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="theme-color" content="#D4A574">
  <link rel="canonical" href="https://fuluckpet.com/story/">
  <link rel="alternate" hreflang="ja" href="https://fuluckpet.com/story/">
  <link rel="alternate" hreflang="en" href="https://fuluckpet.com/story/?lang=en">
  <link rel="alternate" hreflang="zh" href="https://fuluckpet.com/story/?lang=zh">
  <link rel="alternate" hreflang="x-default" href="https://fuluckpet.com/story/">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Klee+One:wght@400&family=Noto+Sans+JP:wght@400;500;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ±</text></svg>">
  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-EK459EK55M"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-EK459EK55M');</script>
  <script type="application/ld+json">
  { "@context":"https://schema.org", "@type":"BreadcrumbList", "itemListElement":[
    {"@type":"ListItem","position":1,"name":"ãƒ›ãƒ¼ãƒ ","item":"https://fuluckpet.com/"},
    {"@type":"ListItem","position":2,"name":"ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰","item":"https://fuluckpet.com/story/"}
  ]}
  </script>

  <style>
    /* ===== Story Card V2: Conversational Wizard ===== */
    :root {
      --story-bg: #FFF8F0;
      --story-accent: #D4A574;
      --story-accent-dark: #B8895A;
      --story-text: #5C4A3A;
      --story-text-light: #9A8676;
      --story-card-bg: #FFFAF5;
      --story-frame: #E8D5C0;
      --story-mint: #7DD3C0;
      --story-pink: #F9B8D0;
      --story-blue: #B8D4F0;
    }

    /* ===== Welcome Hero ===== */
    .story-hero {
      background: linear-gradient(135deg, #FFF8F0 0%, #FDECD2 50%, #FFF0E6 100%);
      padding: 120px 0 60px;
      text-align: center;
    }
    .story-hero .container { max-width: 700px; }
    .story-hero-icon {
      font-size: 56px;
      margin-bottom: 12px;
      display: block;
      animation: pawBounce 2s ease-in-out infinite;
    }
    @keyframes pawBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .story-hero h1 {
      font-family: 'Klee One', serif;
      font-size: clamp(1.8rem, 5vw, 2.6rem);
      font-weight: 400;
      color: var(--story-text);
      margin-bottom: 12px;
      line-height: 1.4;
    }
    .story-hero .hero-sub {
      font-size: 1.05rem;
      color: var(--story-text-light);
      margin-bottom: 8px;
      line-height: 1.8;
    }
    .story-hero .brand-tag {
      font-size: 0.85rem;
      color: var(--story-accent);
      margin-bottom: 32px;
      display: block;
    }

    /* Sample Cards */
    .sample-section {
      margin-bottom: 36px;
    }
    .sample-section h3 {
      font-family: 'Klee One', serif;
      font-size: 1rem;
      color: var(--story-text-light);
      margin-bottom: 16px;
    }
    .sample-cards {
      display: flex;
      gap: 16px;
      justify-content: center;
      overflow-x: auto;
      padding: 8px 0 16px;
      -webkit-overflow-scrolling: touch;
      scroll-snap-type: x mandatory;
    }
    .sample-card {
      flex: 0 0 180px;
      height: 240px;
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: 0 6px 24px rgba(92, 74, 58, 0.12);
      position: relative;
      scroll-snap-align: center;
      transition: transform 0.3s var(--ease-out);
    }
    .sample-card:hover { transform: translateY(-4px) rotate(-1deg); }
    .sample-card:nth-child(2):hover { transform: translateY(-4px) rotate(1deg); }
    .sample-card img {
      width: 100%;
      height: 65%;
      object-fit: cover;
    }
    .sample-card-text {
      padding: 10px 12px;
      background: var(--story-card-bg);
      height: 35%;
    }
    .sample-card-name {
      font-family: 'Klee One', serif;
      font-size: 1rem;
      color: var(--story-accent);
      margin-bottom: 4px;
    }
    .sample-card-caption {
      font-size: 0.7rem;
      color: var(--story-text-light);
      line-height: 1.4;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .story-start-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--story-accent);
      color: white;
      border: none;
      padding: 16px 48px;
      border-radius: var(--radius-lg);
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s var(--ease-out);
      box-shadow: 0 4px 20px rgba(212, 165, 116, 0.3);
    }
    .story-start-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 28px rgba(212, 165, 116, 0.45);
      background: var(--story-accent-dark);
    }

    /* ===== Progress Bar ===== */
    .story-progress {
      display: none;
      justify-content: center;
      align-items: center;
      gap: 0;
      padding: 16px 20px;
      background: var(--story-bg);
      position: sticky;
      top: 72px;
      z-index: 50;
    }
    .story-progress.visible { display: flex; }
    .prog-dot {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid var(--story-frame);
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--story-text-light);
      transition: all 0.4s var(--ease-out);
      flex-shrink: 0;
    }
    .prog-dot.active {
      border-color: var(--story-accent);
      background: var(--story-accent);
      color: white;
      transform: scale(1.1);
    }
    .prog-dot.done {
      border-color: var(--story-accent);
      background: var(--story-accent);
      color: white;
    }
    .prog-line {
      width: 40px;
      height: 2px;
      background: var(--story-frame);
      position: relative;
      flex-shrink: 0;
    }
    .prog-line-fill {
      position: absolute;
      left: 0; top: 0;
      height: 100%;
      width: 0%;
      background: var(--story-accent);
      transition: width 0.4s var(--ease-out);
    }
    .prog-line.done .prog-line-fill { width: 100%; }

    /* ===== Step Container ===== */
    .story-wizard {
      padding: 40px 0 80px;
      background: var(--story-bg);
      min-height: 60vh;
      display: none;
    }
    .story-wizard.visible { display: block; }
    .story-wizard .container { max-width: 640px; }

    .step-card {
      background: white;
      border-radius: var(--radius-lg);
      padding: 36px 32px;
      box-shadow: var(--shadow-card);
      position: relative;
    }
    .step-back-btn {
      position: absolute;
      top: 16px;
      left: 16px;
      background: none;
      border: none;
      color: var(--story-text-light);
      font-size: 0.85rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 8px;
      border-radius: var(--radius-sm);
      transition: all 0.2s;
    }
    .step-back-btn:hover { color: var(--story-text); background: rgba(0,0,0,0.03); }

    .step-prompt {
      font-family: 'Klee One', serif;
      font-size: clamp(1.3rem, 4vw, 1.6rem);
      color: var(--story-text);
      text-align: center;
      margin-bottom: 8px;
      line-height: 1.5;
      padding-top: 8px;
    }
    .step-sub {
      font-size: 0.9rem;
      color: var(--story-text-light);
      text-align: center;
      margin-bottom: 28px;
      line-height: 1.6;
    }

    .step-next-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      background: var(--story-accent);
      color: white;
      border: none;
      padding: 15px;
      border-radius: var(--radius-md);
      font-size: 1.05rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s var(--ease-out);
      box-shadow: 0 4px 16px rgba(212, 165, 116, 0.25);
      margin-top: 24px;
    }
    .step-next-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 24px rgba(212, 165, 116, 0.4);
      background: var(--story-accent-dark);
    }
    .step-next-btn:disabled { opacity: 0.4; cursor: not-allowed; }

    .step-skip-btn {
      display: block;
      margin: 12px auto 0;
      background: none;
      border: none;
      color: var(--story-text-light);
      font-size: 0.85rem;
      cursor: pointer;
      padding: 8px 16px;
      transition: color 0.2s;
    }
    .step-skip-btn:hover { color: var(--story-text); }

    /* Step panels - only one visible at a time */
    .step-panel { display: none; }
    .step-panel.active { display: block; }

    /* ===== Step 1: Photo Upload ===== */
    .photo-upload-area {
      border: 3px dashed var(--story-frame);
      border-radius: var(--radius-lg);
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s var(--ease-out);
      background: var(--story-card-bg);
      position: relative;
      min-height: 180px;
    }
    .photo-upload-area:hover { border-color: var(--story-accent); background: #FFF5EB; }
    .photo-upload-area.has-photo {
      padding: 12px;
      border-style: solid;
      border-color: var(--story-accent);
    }
    .photo-upload-icon { font-size: 48px; display: block; margin-bottom: 12px; }
    .photo-upload-text { color: var(--story-text-light); font-size: 0.95rem; }
    .photo-upload-text strong { color: var(--story-accent); }
    .photo-preview {
      max-width: 100%;
      max-height: 280px;
      border-radius: var(--radius-md);
      display: none;
    }
    .photo-upload-area.has-photo .photo-preview { display: block; margin: 0 auto; }
    .photo-upload-area.has-photo .photo-upload-icon,
    .photo-upload-area.has-photo .photo-upload-text { display: none; }
    .photo-change-hint {
      display: none;
      font-size: 0.8rem;
      color: var(--story-text-light);
      margin-top: 8px;
    }
    .photo-upload-area.has-photo .photo-change-hint { display: block; }
    #photoInput { display: none; }

    /* AI Analysis feedback */
    .ai-analysis-box {
      margin-top: 16px;
      display: none;
    }
    .ai-analysis-box.visible { display: block; }
    .ai-loading {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      color: var(--story-text-light);
      font-size: 0.9rem;
      padding: 12px;
    }
    .ai-loading .paw-walk {
      display: inline-block;
      animation: pawWalk 1.2s ease-in-out infinite;
    }
    @keyframes pawWalk {
      0%, 100% { transform: translateX(-8px); opacity: 0.5; }
      50% { transform: translateX(8px); opacity: 1; }
    }
    .ai-result-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      display: none;
    }
    .ai-result-chips.visible { display: flex; }
    .ai-chip {
      padding: 6px 14px;
      border-radius: 100px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    .ai-chip-color { background: #EDE7F6; color: #5E35B1; }
    .ai-chip-trait { background: #FCE4EC; color: #C62828; }

    /* ===== Step 2: Name + Gender ===== */
    .name-input {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid var(--story-frame);
      border-radius: var(--radius-md);
      font-size: 1.3rem;
      color: var(--story-text);
      background: var(--story-card-bg);
      text-align: center;
      font-family: 'Klee One', serif;
      transition: border-color 0.3s, box-shadow 0.3s;
      box-sizing: border-box;
    }
    .name-input:focus {
      outline: none;
      border-color: var(--story-accent);
      box-shadow: 0 0 0 4px rgba(212, 165, 116, 0.12);
    }
    .name-input::placeholder { color: #C8B8A8; font-size: 1rem; }
    .name-hint {
      text-align: center;
      font-size: 0.8rem;
      color: var(--story-text-light);
      margin-top: 6px;
      margin-bottom: 20px;
    }

    .gender-cards {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 4px;
    }
    .gender-card {
      padding: 24px 16px;
      border: 2px solid transparent;
      border-radius: var(--radius-lg);
      text-align: center;
      cursor: pointer;
      transition: all 0.3s var(--ease-out);
      position: relative;
    }
    .gender-card-boy { background: #EBF2FC; }
    .gender-card-girl { background: #FCEEF3; }
    .gender-card.selected {
      transform: scale(1.03);
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    }
    .gender-card-boy.selected { border-color: #6B9BD2; }
    .gender-card-girl.selected { border-color: #D4789C; }
    .gender-card:not(.selected) { opacity: 1; }
    .gender-card .peer-selected { opacity: 0.55; }
    .gender-card-emoji { font-size: 40px; display: block; margin-bottom: 8px; }
    .gender-card-label { font-size: 1rem; font-weight: 600; color: var(--story-text); }
    .gender-card .check-badge {
      display: none;
      position: absolute;
      top: 8px; right: 8px;
      width: 24px; height: 24px;
      border-radius: 50%;
      background: var(--story-accent);
      color: white;
      font-size: 14px;
      line-height: 24px;
      text-align: center;
    }
    .gender-card.selected .check-badge { display: block; }

    /* ===== Step 3: Color Chips + Date ===== */
    .color-chip-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 24px;
    }
    .color-chip {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 14px;
      border: 2px solid var(--story-frame);
      border-radius: var(--radius-md);
      background: white;
      cursor: pointer;
      transition: all 0.25s var(--ease-out);
      font-size: 0.9rem;
      color: var(--story-text);
    }
    .color-chip:hover { border-color: var(--story-accent); }
    .color-chip.selected {
      border-color: var(--story-accent);
      background: #FFF5EB;
      font-weight: 600;
    }
    .color-chip.ai-suggested {
      box-shadow: 0 0 0 2px rgba(212, 165, 116, 0.3);
    }
    .color-chip-emoji { font-size: 1.1rem; flex-shrink: 0; }
    .color-custom-input {
      display: none;
      margin-top: 10px;
    }
    .color-custom-input.visible { display: block; }
    .color-custom-input input {
      width: 100%;
      padding: 10px 14px;
      border: 2px solid var(--story-frame);
      border-radius: var(--radius-sm);
      font-size: 0.95rem;
      color: var(--story-text);
      background: var(--story-card-bg);
      box-sizing: border-box;
    }
    .color-custom-input input:focus {
      outline: none;
      border-color: var(--story-accent);
    }

    .date-group { margin-top: 0; }
    .date-group label {
      display: block;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--story-text);
      margin-bottom: 6px;
    }
    .date-group input[type="date"] {
      width: 100%;
      padding: 12px 14px;
      border: 2px solid var(--story-frame);
      border-radius: var(--radius-sm);
      font-size: 1rem;
      color: var(--story-text);
      background: var(--story-card-bg);
      box-sizing: border-box;
    }
    .date-group input[type="date"]:focus {
      outline: none;
      border-color: var(--story-accent);
    }

    /* ===== Step 4: Pet Multi-Select ===== */
    .pet-card-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .pet-card {
      padding: 16px 8px;
      border: 2px solid var(--story-frame);
      border-radius: var(--radius-md);
      background: white;
      text-align: center;
      cursor: pointer;
      transition: all 0.25s var(--ease-out);
      position: relative;
    }
    .pet-card:hover { border-color: var(--story-accent); }
    .pet-card.selected {
      border-color: var(--story-accent);
      background: #FFF5EB;
    }
    .pet-card-emoji { font-size: 32px; display: block; margin-bottom: 4px; }
    .pet-card-label { font-size: 0.75rem; color: var(--story-text); line-height: 1.3; }
    .pet-card .check-badge {
      display: none;
      position: absolute;
      top: 4px; right: 4px;
      width: 20px; height: 20px;
      border-radius: 50%;
      background: var(--story-accent);
      color: white;
      font-size: 11px;
      line-height: 20px;
      text-align: center;
    }
    .pet-card.selected .check-badge { display: block; }

    /* ===== Step 5: Traits + Story ===== */
    .trait-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .trait-chip {
      padding: 8px 18px;
      border: 2px solid var(--story-frame);
      border-radius: 100px;
      background: white;
      font-size: 0.85rem;
      color: var(--story-text);
      cursor: pointer;
      transition: all 0.25s var(--ease-out);
    }
    .trait-chip:hover { border-color: var(--story-accent); }
    .trait-chip.selected {
      border-color: var(--story-accent);
      background: var(--story-accent);
      color: white;
    }
    .trait-chip.ai-suggested { box-shadow: 0 0 0 2px rgba(212, 165, 116, 0.25); }

    .story-textarea {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid var(--story-frame);
      border-radius: var(--radius-md);
      font-size: 0.95rem;
      color: var(--story-text);
      background: var(--story-card-bg);
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
      line-height: 1.6;
      box-sizing: border-box;
    }
    .story-textarea:focus {
      outline: none;
      border-color: var(--story-accent);
      box-shadow: 0 0 0 3px rgba(212, 165, 116, 0.12);
    }
    .story-textarea::placeholder { color: #C8B8A8; }

    .generate-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      background: linear-gradient(135deg, #F9B8D0 0%, #FFDAB8 50%, #FFE5A0 100%);
      color: var(--story-text);
      border: none;
      padding: 18px;
      border-radius: var(--radius-md);
      font-size: 1.15rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s var(--ease-out);
      box-shadow: 0 4px 20px rgba(249, 184, 208, 0.3);
      margin-top: 24px;
    }
    .generate-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 30px rgba(249, 184, 208, 0.45);
    }

    /* ===== Loading ===== */
    .story-loading {
      padding: 80px 0;
      text-align: center;
      background: var(--story-bg);
      min-height: 50vh;
      display: none;
      align-items: center;
      justify-content: center;
    }
    .story-loading.visible { display: flex; }
    .loading-paws {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: 24px;
    }
    .loading-paws span {
      font-size: 32px;
      animation: pawFade 1.5s ease-in-out infinite;
    }
    .loading-paws span:nth-child(2) { animation-delay: 0.3s; }
    .loading-paws span:nth-child(3) { animation-delay: 0.6s; }
    @keyframes pawFade {
      0%, 100% { opacity: 0.3; transform: scale(0.8); }
      50% { opacity: 1; transform: scale(1.1); }
    }
    .loading-text {
      font-family: 'Klee One', serif;
      font-size: 1.2rem;
      color: var(--story-text);
      margin-bottom: 8px;
    }
    .loading-hint {
      font-size: 0.9rem;
      color: var(--story-text-light);
    }

    /* ===== Result Section ===== */
    .story-result {
      padding: 60px 0 100px;
      background: var(--story-bg);
      display: none;
    }
    .story-result.visible { display: block; }
    .story-result .container { max-width: 720px; }
    .result-title {
      font-family: 'Klee One', serif;
      font-size: 1.6rem;
      color: var(--story-text);
      text-align: center;
      margin-bottom: 32px;
    }
    .card-lang-tabs {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 28px;
    }
    .card-lang-tab {
      padding: 10px 28px;
      border: 2px solid var(--story-frame);
      border-radius: 999px;
      background: white;
      color: var(--story-text-light);
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s var(--ease-out);
    }
    .card-lang-tab.active {
      background: var(--story-accent);
      border-color: var(--story-accent);
      color: white;
    }
    .card-preview-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 24px;
    }
    .card-preview-wrapper {
      width: 100%;
      max-width: 360px;
      aspect-ratio: 3 / 4;
      overflow: hidden;
      border-radius: var(--radius-lg);
      box-shadow: 0 8px 40px rgba(92, 74, 58, 0.15);
      position: relative;
    }
    .card-preview-inner {
      width: 1080px;
      height: 1440px;
      transform: scale(var(--preview-scale, 0.333));
      transform-origin: top left;
    }
    .text-display-card {
      background: white;
      border-radius: var(--radius-md);
      padding: 24px;
      width: 100%;
      box-shadow: var(--shadow-soft);
    }
    .text-display-label {
      font-size: 0.8rem;
      color: var(--story-text-light);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }
    .text-display-content {
      font-size: 0.95rem;
      color: var(--story-text);
      line-height: 1.8;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .result-actions {
      display: flex;
      gap: 12px;
      width: 100%;
      margin-top: 8px;
    }
    .result-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px 20px;
      border-radius: var(--radius-md);
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s var(--ease-out);
      border: none;
    }
    .result-btn-primary {
      background: var(--story-accent);
      color: white;
      box-shadow: 0 4px 16px rgba(212, 165, 116, 0.3);
    }
    .result-btn-primary:hover {
      transform: translateY(-2px);
      background: var(--story-accent-dark);
    }
    .result-btn-secondary {
      background: white;
      color: var(--story-text);
      border: 2px solid var(--story-frame) !important;
    }
    .result-btn-secondary:hover { border-color: var(--story-accent) !important; color: var(--story-accent); }
    .share-hint {
      text-align: center;
      margin-top: 24px;
      padding: 16px;
      background: rgba(212, 165, 116, 0.08);
      border-radius: var(--radius-md);
      font-size: 0.85rem;
      color: var(--story-text-light);
      line-height: 1.6;
    }
    .share-hint strong { color: var(--story-accent); }
    .retry-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-top: 24px;
      padding: 10px 24px;
      background: transparent;
      color: var(--story-text-light);
      border: 1px solid var(--story-frame);
      border-radius: 999px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s var(--ease-out);
    }
    .retry-btn:hover { border-color: var(--story-accent); color: var(--story-text); }

    /* Hidden card for html2canvas */
    #card-canvas {
      position: absolute;
      left: -9999px;
      top: 0;
      width: 1080px;
      height: 1440px;
      background: var(--story-card-bg);
      font-family: 'Klee One', 'Noto Sans JP', 'Noto Sans SC', sans-serif;
      overflow: hidden;
    }
    .card-photo-area { width: 100%; height: 60%; position: relative; overflow: hidden; }
    .card-photo { width: 100%; height: 100%; background-size: cover; background-position: center; }
    .card-photo-overlay {
      position: absolute; bottom: 0; left: 0; right: 0; height: 160px;
      background: linear-gradient(transparent, rgba(255,248,240,0.9));
    }
    .card-text-area {
      padding: 36px 56px 24px;
      text-align: center;
      height: 30%;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .card-cat-name { font-family: 'Klee One', serif; font-size: 52px; color: var(--story-accent); margin-bottom: 16px; }
    .card-ai-text { font-size: 28px; line-height: 1.7; color: var(--story-text); margin-bottom: 16px; padding: 0 20px; }
    .card-date { font-size: 22px; color: var(--story-text-light); }
    .card-brand-bar {
      position: absolute; bottom: 0; width: 100%; height: 10%;
      background: rgba(232, 213, 192, 0.15);
      display: flex; align-items: center; justify-content: center; gap: 24px;
      font-size: 20px; color: var(--story-text-light);
    }
    .card-brand-bar .brand-paw { font-size: 28px; }
    .card-brand-bar .brand-name { font-family: 'Klee One', serif; font-size: 22px; }
    .card-brand-bar .brand-ig { font-size: 18px; opacity: 0.7; }

    /* Error */
    .story-error {
      background: #FFF0F0;
      border: 1px solid #E57373;
      color: #D32F2F;
      padding: 14px;
      border-radius: var(--radius-sm);
      text-align: center;
      margin-bottom: 16px;
      display: none;
      font-size: 0.9rem;
    }

    /* Responsive */
    @media (max-width: 900px) {
      .story-hero { padding: 110px 20px 40px; }
      .step-card { padding: 28px 20px; }
      .result-actions { flex-direction: column; }
      .card-preview-wrapper { max-width: 300px; }
      .sample-cards { justify-content: flex-start; padding: 8px 16px 16px; }
      .color-chip-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 400px) {
      .pet-card-grid { grid-template-columns: repeat(2, 1fr); }
      .color-chip-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <!-- Scroll Progress Bar -->
  <div class="scroll-progress"></div>

  <!-- ========== HEADER ========== -->
  <header class="header" id="header">
    <div class="header-inner">
      <a href="/index.html" class="logo">
        <span class="logo-icon">ğŸ¾</span>
        <span class="logo-text">ç¦æ¥½ã‚­ãƒ£ãƒƒãƒ†ãƒªãƒ¼</span>
      </a>

      <nav class="nav" id="nav">
        <a href="/index.html#about" class="nav-link" data-i18n="nav.about">çŒ«èˆã«ã¤ã„ã¦</a>
        <a href="/index.html#kittens" class="nav-link" data-i18n="nav.kittens">å­çŒ«ä¸€è¦§</a>
        <a href="/index.html#parents" class="nav-link" data-i18n="nav.parents">è¦ªçŒ«ç´¹ä»‹</a>
        <a href="/index.html#visit" class="nav-link" data-i18n="nav.visit">è¦‹å­¦æ¡ˆå†…</a>
        <a href="/index.html#faq" class="nav-link" data-i18n="nav.faq">ã‚ˆãã‚ã‚‹è³ªå•</a>
        <a href="/guide/" class="nav-link" data-i18n="nav.guide">ãŠè¿ãˆã‚¬ã‚¤ãƒ‰</a>
        <a href="/blog.html" class="nav-link" data-i18n="nav.blog">çŸ¥è­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</a>
        <div class="nav-dropdown">
          <button class="nav-link nav-dropdown-toggle" data-i18n="nav.more">ã‚‚ã£ã¨è¦‹ã‚‹ <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></button>
          <div class="nav-dropdown-menu">
            <a href="/siberian.html" class="nav-dropdown-item" data-i18n="nav.siberian">ã‚µã‚¤ãƒ™ãƒªã‚¢ãƒ³ã®é­…åŠ›</a>
            <a href="/about.html" class="nav-dropdown-item" data-i18n="nav.aboutPage">å—è³æ­´ãƒ»èªå®š</a>
            <a href="/kittens.html" class="nav-dropdown-item" data-i18n="nav.allKittens">å­çŒ«ä¸€è¦§ï¼ˆã™ã¹ã¦ï¼‰</a>
            <a href="/parents.html" class="nav-dropdown-item" data-i18n="nav.allParents">è¦ªçŒ«ç´¹ä»‹ï¼ˆã™ã¹ã¦ï¼‰</a>
            <a href="/gallery.html" class="nav-dropdown-item" data-i18n="nav.gallery">å’æ¥­çŒ«ã‚®ãƒ£ãƒ©ãƒªãƒ¼</a>
            <a href="/reviews.html" class="nav-dropdown-item" data-i18n="nav.reviews">ãŠå®¢æ§˜ã®å£°</a>
            <div class="nav-dropdown-divider"></div>
            <a href="https://catnamegive.mouxue56.workers.dev" target="_blank" rel="noopener" class="nav-dropdown-item" data-i18n="nav.naming">å­çŒ«ã®åå‰ãƒ„ãƒ¼ãƒ«</a>
          </div>
        </div>
      </nav>

      <div class="header-right">
        <div class="lang-switch">
          <button class="lang-btn active" data-lang="ja">JP</button>
          <button class="lang-btn" data-lang="en">EN</button>
          <button class="lang-btn" data-lang="zh">ä¸­</button>
        </div>

        <div class="header-sns">
          <a href="https://www.instagram.com/fuluckpet/" class="sns-icon" aria-label="Instagram" target="_blank" rel="noopener">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="5"/><circle cx="12" cy="12" r="5"/><circle cx="17.5" cy="6.5" r="1.5" fill="currentColor" stroke="none"/></svg>
          </a>
          <a href="https://www.youtube.com/channel/UCuVbvcbkbXs6MaBN2G1Zx1A" class="sns-icon" aria-label="YouTube" target="_blank" rel="noopener">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 12a29 29 0 0 0 .46 5.58 2.78 2.78 0 0 0 1.94 2C5.12 20 12 20 12 20s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2A29 29 0 0 0 23 12a29 29 0 0 0-.46-5.58z"/><polygon points="9.75 15.02 15.5 12 9.75 8.98 9.75 15.02" fill="currentColor" stroke="none"/></svg>
          </a>
          <a href="https://www.tiktok.com/@fuluckpet" class="sns-icon" aria-label="TikTok" target="_blank" rel="noopener">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-2.88 2.5 2.89 2.89 0 0 1 0-5.78 2.92 2.92 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 3 15.57 6.33 6.33 0 0 0 9.37 22a6.33 6.33 0 0 0 6.33-6.33V9.18a8.16 8.16 0 0 0 3.89.98V6.73a4.85 4.85 0 0 1-.01-.04z"/></svg>
          </a>
        </div>

        <button class="hamburger" id="hamburger" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
          <span></span><span></span><span></span>
        </button>
      </div>
    </div>
  </header>

  <!-- ========== MOBILE NAV ========== -->
  <div class="mobile-nav" id="mobileNav">
    <nav>
      <a href="/index.html#about" class="mobile-nav-link" data-i18n="nav.about">çŒ«èˆã«ã¤ã„ã¦</a>
      <a href="/index.html#kittens" class="mobile-nav-link" data-i18n="nav.kittens">å­çŒ«ä¸€è¦§</a>
      <a href="/index.html#parents" class="mobile-nav-link" data-i18n="nav.parents">è¦ªçŒ«ç´¹ä»‹</a>
      <a href="/index.html#visit" class="mobile-nav-link" data-i18n="nav.visit">è¦‹å­¦æ¡ˆå†…</a>
      <a href="/index.html#faq" class="mobile-nav-link" data-i18n="nav.faq">ã‚ˆãã‚ã‚‹è³ªå•</a>
      <a href="/siberian.html" class="mobile-nav-link" data-i18n="nav.siberian">ã‚µã‚¤ãƒ™ãƒªã‚¢ãƒ³</a>
      <a href="/kittens.html" class="mobile-nav-link" data-i18n="nav.allKittens">å­çŒ«ä¸€è¦§ï¼ˆã™ã¹ã¦ï¼‰</a>
      <a href="/parents.html" class="mobile-nav-link" data-i18n="nav.allParents">è¦ªçŒ«ç´¹ä»‹ï¼ˆã™ã¹ã¦ï¼‰</a>
      <a href="/gallery.html" class="mobile-nav-link" data-i18n="nav.gallery">ã‚®ãƒ£ãƒ©ãƒªãƒ¼</a>
      <a href="/reviews.html" class="mobile-nav-link" data-i18n="nav.reviews">ãŠå®¢æ§˜ã®å£°</a>
      <a href="/about.html" class="mobile-nav-link" data-i18n="nav.aboutPage">å—è³æ­´ãƒ»èªå®š</a>
      <a href="/guide/" class="mobile-nav-link" data-i18n="nav.guide">ãŠè¿ãˆã‚¬ã‚¤ãƒ‰</a>
      <a href="/blog.html" class="mobile-nav-link" data-i18n="nav.blog">çŸ¥è­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</a>
      <a href="https://catnamegive.mouxue56.workers.dev" target="_blank" rel="noopener" class="mobile-nav-link" data-i18n="nav.naming">å­çŒ«ã®åå‰ãƒ„ãƒ¼ãƒ«</a>
    </nav>
    <div class="mobile-nav-bottom">
      <div class="lang-switch mobile-lang">
        <button class="lang-btn active" data-lang="ja">JP</button>
        <button class="lang-btn" data-lang="en">EN</button>
        <button class="lang-btn" data-lang="zh">ä¸­</button>
      </div>
    </div>
  </div>

  <!-- ========== WELCOME ========== -->
  <section class="story-hero" id="screen-welcome">
    <div class="container">
      <span class="story-hero-icon">ğŸ¾</span>
      <h1 data-i18n="story.title">ã†ã¡ã®å­ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰</h1>
      <p class="hero-sub" data-i18n="story.subtitle">å‡ºä¼šã„ã®ç¬é–“ã‚’ã€ä¸–ç•Œã«ã²ã¨ã¤ã®ã‚«ãƒ¼ãƒ‰ã«ã€‚</p>
      <span class="brand-tag">ã‚µã‚¤ãƒ™ãƒªã‚¢ãƒ³ï½œå¤§é˜ªãƒ»ç¦æ¥½ã‚­ãƒ£ãƒƒãƒ†ãƒªãƒ¼</span>

      <div class="sample-section">
        <h3 data-i18n="story.sampleTitle">ã“ã‚“ãªã‚«ãƒ¼ãƒ‰ãŒä½œã‚Œã¾ã™</h3>
        <div class="sample-cards">
          <div class="sample-card">
            <img src="https://fuluck-api.mouxue56.workers.dev/r2/uploads/1770724780473-b1cd27ac.jpg" alt="Sample" loading="lazy">
            <div class="sample-card-text">
              <div class="sample-card-name">ã‚†ã</div>
              <div class="sample-card-caption">çœŸã£ç™½ãªãµã‚ãµã‚ãŒæˆ‘ãŒå®¶ã«ã‚„ã£ã¦ããŸæ—¥ã€‚</div>
            </div>
          </div>
          <div class="sample-card">
            <img src="https://fuluck-api.mouxue56.workers.dev/r2/uploads/1770724768508-19a4ab1e.jpg" alt="Sample" loading="lazy">
            <div class="sample-card-text">
              <div class="sample-card-name">ãƒ¢ã‚«</div>
              <div class="sample-card-caption">åˆã‚ã¦ç›®ãŒåˆã£ãŸç¬é–“ã€é‹å‘½ã‚’æ„Ÿã˜ã¾ã—ãŸã€‚</div>
            </div>
          </div>
          <div class="sample-card">
            <img src="https://fuluck-api.mouxue56.workers.dev/r2/uploads/1770724781684-5154c156.jpg" alt="Sample" loading="lazy">
            <div class="sample-card-text">
              <div class="sample-card-name">ãƒ¬ã‚ª</div>
              <div class="sample-card-caption">ã‚„ã‚“ã¡ã‚ƒã§ç”˜ãˆã‚“åŠãªæ–°ã—ã„å®¶æ—ã€‚</div>
            </div>
          </div>
        </div>
      </div>

      <button class="story-start-btn" id="startBtn" data-i18n="story.start">ã‚«ãƒ¼ãƒ‰ã‚’ä½œã‚‹</button>
    </div>
  </section>

  <!-- ========== PROGRESS BAR ========== -->
  <div class="story-progress" id="progressBar">
    <div class="prog-dot active" data-step="1">1</div>
    <div class="prog-line"><div class="prog-line-fill"></div></div>
    <div class="prog-dot" data-step="2">2</div>
    <div class="prog-line"><div class="prog-line-fill"></div></div>
    <div class="prog-dot" data-step="3">3</div>
    <div class="prog-line"><div class="prog-line-fill"></div></div>
    <div class="prog-dot" data-step="4">4</div>
    <div class="prog-line"><div class="prog-line-fill"></div></div>
    <div class="prog-dot" data-step="5">5</div>
  </div>

  <!-- ========== WIZARD STEPS ========== -->
  <section class="story-wizard" id="screen-wizard">
    <div class="container">
      <div id="wizardError" class="story-error"></div>

      <!-- Step 1: Photo -->
      <div class="step-panel active" id="step-1">
        <div class="step-card">
          <p class="step-prompt" data-i18n="story.step1Prompt">ã¾ãšã€ãŠæ°—ã«å…¥ã‚Šã®1æšã‚’è¦‹ã›ã¦ï¼ğŸ“¸</p>
          <p class="step-sub" data-i18n="story.step1Sub">çŒ«ã¡ã‚ƒã‚“ã®å†™çœŸã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã­ã€‚AIãŒæ¯›è‰²ã‚„ç‰¹å¾´ã‚’èª­ã¿å–ã‚‹ã‚ˆã€‚</p>

          <div class="photo-upload-area" id="photoArea">
            <span class="photo-upload-icon">ğŸ“·</span>
            <p class="photo-upload-text" data-i18n="story.photoClick">ã‚¿ãƒƒãƒ—ã—ã¦å†™çœŸã‚’é¸ã¶</p>
            <img class="photo-preview" id="photoPreview" alt="Preview">
            <p class="photo-change-hint" data-i18n="story.photoChange">ã‚¿ãƒƒãƒ—ã—ã¦å†™çœŸã‚’å¤‰æ›´</p>
          </div>
          <input type="file" id="photoInput" accept="image/*">

          <div class="ai-analysis-box" id="aiAnalysisBox">
            <div class="ai-loading" id="aiLoading">
              <span class="paw-walk">ğŸ¾</span>
              <span data-i18n="story.analyzing">AIãŒåˆ†æä¸­...</span>
            </div>
            <div class="ai-result-chips" id="aiResultChips"></div>
          </div>

          <button class="step-next-btn" id="step1Next" disabled data-i18n="story.next">æ¬¡ã¸</button>
        </div>
      </div>

      <!-- Step 2: Name + Gender -->
      <div class="step-panel" id="step-2">
        <div class="step-card">
          <button class="step-back-btn" data-back>â† <span data-i18n="story.back">æˆ»ã‚‹</span></button>
          <p class="step-prompt" id="step2Prompt" data-i18n="story.step2Prompt">ç´ æ•µãªå­ï¼åå‰ã‚’æ•™ãˆã¦ ğŸ±</p>
          <p class="step-sub" data-i18n="story.step2Sub">ãŠè¿ãˆã—ãŸçŒ«ã¡ã‚ƒã‚“ã®ãŠåå‰ã¨æ€§åˆ¥ã‚’é¸ã‚“ã§ã­ã€‚</p>

          <input type="text" class="name-input" id="catName"
            data-placeholder-ja="ã«ã‚ƒã‚“ã“ã®åå‰"
            data-placeholder-en="Your cat's name"
            data-placeholder-zh="çŒ«å’ªçš„åå­—"
            placeholder="ã«ã‚ƒã‚“ã“ã®åå‰">
          <p class="name-hint" data-i18n="story.nameHint">ä¾‹ï¼šã‚†ãã€ãƒ¢ã‚«ã€ãƒ¬ã‚ª</p>

          <div class="gender-cards">
            <div class="gender-card gender-card-boy" data-value="ç”·ã®å­">
              <span class="check-badge">âœ“</span>
              <span class="gender-card-emoji">â™‚</span>
              <span class="gender-card-label" data-i18n="story.genderMale">ç”·ã®å­</span>
            </div>
            <div class="gender-card gender-card-girl" data-value="å¥³ã®å­">
              <span class="check-badge">âœ“</span>
              <span class="gender-card-emoji">â™€</span>
              <span class="gender-card-label" data-i18n="story.genderFemale">å¥³ã®å­</span>
            </div>
          </div>

          <button class="step-next-btn" id="step2Next" disabled data-i18n="story.next">æ¬¡ã¸</button>
        </div>
      </div>

      <!-- Step 3: Color + Date -->
      <div class="step-panel" id="step-3">
        <div class="step-card">
          <button class="step-back-btn" data-back>â† <span data-i18n="story.back">æˆ»ã‚‹</span></button>
          <p class="step-prompt" id="step3Prompt" data-i18n="story.step3Prompt">æ¯›è‰²ã‚’ç¢ºèªã—ã¦ã­ ğŸ¨</p>
          <p class="step-sub" data-i18n="story.step3Sub">AIãŒæ¤œå‡ºã—ãŸæ¯›è‰²ã‚’ç¢ºèªã—ã¦ã€ãŠè¿ãˆæ—¥ã‚‚æ•™ãˆã¦ã­ã€‚</p>

          <div class="color-chip-grid" id="colorGrid">
            <!-- Populated by JS -->
          </div>
          <div class="color-custom-input" id="colorCustom">
            <input type="text" id="colorCustomInput"
              data-placeholder-ja="æ¯›è‰²ã‚’å…¥åŠ›"
              data-placeholder-en="Enter coat color"
              data-placeholder-zh="è¾“å…¥æ¯›è‰²"
              placeholder="æ¯›è‰²ã‚’å…¥åŠ›">
          </div>

          <div class="date-group">
            <label data-i18n="story.date">ğŸ  ãŠè¿ãˆæ—¥</label>
            <input type="date" id="catDate">
          </div>

          <button class="step-next-btn" id="step3Next" disabled data-i18n="story.next">æ¬¡ã¸</button>
        </div>
      </div>

      <!-- Step 4: Other Pets -->
      <div class="step-panel" id="step-4">
        <div class="step-card">
          <button class="step-back-btn" data-back>â† <span data-i18n="story.back">æˆ»ã‚‹</span></button>
          <p class="step-prompt" id="step4Prompt" data-i18n="story.step4Prompt">ãŠã†ã¡ã«å…„å¼Ÿã¯ã„ã‚‹ï¼Ÿ ğŸ </p>
          <p class="step-sub" data-i18n="story.step4Sub">ä»–ã®ãƒšãƒƒãƒˆã‚’æ•™ãˆã¦ã­ï¼ˆè¤‡æ•°é¸æŠOKï¼‰</p>

          <div class="pet-card-grid" id="petGrid">
            <!-- Populated by JS -->
          </div>

          <button class="step-next-btn" id="step4Next" data-i18n="story.next">æ¬¡ã¸</button>
          <button class="step-skip-btn" data-skip="5" data-i18n="story.skip">ã‚¹ã‚­ãƒƒãƒ— ></button>
        </div>
      </div>

      <!-- Step 5: Personality + Story -->
      <div class="step-panel" id="step-5">
        <div class="step-card">
          <button class="step-back-btn" data-back>â† <span data-i18n="story.back">æˆ»ã‚‹</span></button>
          <p class="step-prompt" id="step5Prompt" data-i18n="story.step5Prompt">æœ€å¾Œã«ã€æ€§æ ¼ã‚„ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚’æ•™ãˆã¦ ğŸ’•</p>
          <p class="step-sub" data-i18n="story.step5Sub">ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ã‚‚å¤§ä¸ˆå¤«ï¼AIãŒå†™çœŸã‹ã‚‰ã„ã„æ„Ÿã˜ã«ä»•ä¸Šã’ã‚‹ã‚ˆã€‚</p>

          <div class="trait-chips" id="traitChips">
            <!-- Populated by JS -->
          </div>

          <textarea class="story-textarea" id="catStory" rows="4"
            data-placeholder-ja="ä¾‹ï¼šã†ã¡ã«æ¥ãŸåˆæ—¥ã€ã™ãã«ãŠè†ã®ä¸Šã§å¯ã¦ãã‚Œã¾ã—ãŸ..."
            data-placeholder-en="e.g. On the first day home, she fell asleep on my lap..."
            data-placeholder-zh="ä¾‹ï¼šåˆ°å®¶ç¬¬ä¸€å¤©å°±è¶´åœ¨è†ç›–ä¸Šç¡ç€äº†..."
            placeholder="ä¾‹ï¼šã†ã¡ã«æ¥ãŸåˆæ—¥ã€ã™ãã«ãŠè†ã®ä¸Šã§å¯ã¦ãã‚Œã¾ã—ãŸ..."></textarea>

          <button class="generate-btn" id="generateBtn" data-i18n="story.generateFinal">ğŸ‰ ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’ä½œã‚‹ï¼</button>
          <button class="step-skip-btn" id="skipGenBtn" data-i18n="story.skipGenerate">ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãªã—ã§ä½œã‚‹</button>
        </div>
      </div>
    </div>
  </section>

  <!-- ========== LOADING ========== -->
  <section class="story-loading" id="screen-loading">
    <div class="container">
      <div class="loading-paws">
        <span>ğŸ¾</span><span>ğŸ¾</span><span>ğŸ¾</span>
      </div>
      <p class="loading-text" data-i18n="story.loading">AIãŒæ–‡ç« ã‚’ä½œæˆä¸­...</p>
      <p class="loading-hint" data-i18n="story.loadingHint">å°‘ã€…ãŠå¾…ã¡ãã ã•ã„ï¼ˆç´„10ç§’ï¼‰</p>
    </div>
  </section>

  <!-- ========== RESULT ========== -->
  <section class="story-result" id="screen-result">
    <div class="container">
      <h2 class="result-title" data-i18n="story.resultTitle">ã‚«ãƒ¼ãƒ‰ãŒå®Œæˆã—ã¾ã—ãŸï¼</h2>

      <div class="card-lang-tabs">
        <button class="card-lang-tab active" data-lang="ja" data-i18n="story.tabJa">æ—¥æœ¬èªç‰ˆ</button>
        <button class="card-lang-tab" data-lang="zh" data-i18n="story.tabZh">ä¸­æ–‡ç‰ˆ</button>
      </div>

      <div class="card-preview-container">
        <div class="card-preview-wrapper">
          <div class="card-preview-inner" id="card-preview"></div>
        </div>

        <div class="text-display-card">
          <p class="text-display-label" id="textLabel">Instagram / SNS</p>
          <div class="text-display-content" id="copyText"></div>
        </div>

        <div class="result-actions">
          <button class="result-btn result-btn-primary" id="downloadBtn">
            <span data-i18n="story.download">ğŸ“¥ ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</span>
          </button>
          <button class="result-btn result-btn-secondary" id="copyBtn">
            <span data-i18n="story.copyText">ğŸ“‹ ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼</span>
          </button>
        </div>

        <div class="share-hint" data-i18n="story.shareHint">Instagramã«æŠ•ç¨¿ã™ã‚‹éš›ã¯ <strong>@fuluckpet</strong> ã‚’ã‚¿ã‚°ä»˜ã‘ã—ã¦ã­ï¼</div>
      </div>

      <div style="text-align:center">
        <button class="retry-btn" id="retryBtn" data-i18n="story.retry">ğŸ”„ ã‚‚ã†1æšä½œã‚‹</button>
      </div>
    </div>
  </section>

  <!-- ========== HIDDEN CARD CANVAS (1080x1440) ========== -->
  <div id="card-canvas">
    <div class="card-photo-area">
      <div class="card-photo" id="cardPhoto"></div>
      <div class="card-photo-overlay"></div>
    </div>
    <div class="card-text-area">
      <div class="card-cat-name" id="cardName"></div>
      <div class="card-ai-text" id="cardText"></div>
      <div class="card-date" id="cardDate"></div>
    </div>
    <div class="card-brand-bar">
      <span class="brand-paw">ğŸ¾</span>
      <span class="brand-name">ã‚µã‚¤ãƒ™ãƒªã‚¢ãƒ³ï½œå¤§é˜ªãƒ»ç¦æ¥½ã‚­ãƒ£ãƒƒãƒ†ãƒªãƒ¼</span>
      <span class="brand-ig">@fuluckpet</span>
    </div>
  </div>

  <!-- ========== FOOTER ========== -->
  <footer class="footer" id="footer">
    <div class="container">
      <div class="footer-top">
        <div class="footer-brand">
          <div class="f-logo">
            <span class="logo-icon">ğŸ¾</span>
            <span class="f-logo-text">ç¦æ¥½ã‚­ãƒ£ãƒƒãƒ†ãƒªãƒ¼</span>
          </div>
          <p class="f-tagline">ã‚µã‚¤ãƒ™ãƒªã‚¢ãƒ³ï½œå¤§é˜ªãƒ»ç¦æ¥½ã‚­ãƒ£ãƒƒãƒ†ãƒªãƒ¼</p>
          <div class="f-sns">
            <a href="https://www.instagram.com/fuluckpet/" class="sns-icon" aria-label="Instagram"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="5"/><circle cx="12" cy="12" r="5"/><circle cx="17.5" cy="6.5" r="1.5" fill="currentColor" stroke="none"/></svg></a>
            <a href="https://www.youtube.com/channel/UCuVbvcbkbXs6MaBN2G1Zx1A" class="sns-icon" aria-label="YouTube"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 12a29 29 0 0 0 .46 5.58 2.78 2.78 0 0 0 1.94 2C5.12 20 12 20 12 20s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2A29 29 0 0 0 23 12a29 29 0 0 0-.46-5.58z"/><polygon points="9.75 15.02 15.5 12 9.75 8.98 9.75 15.02" fill="currentColor" stroke="none"/></svg></a>
            <a href="https://www.tiktok.com/@fuluckpet" class="sns-icon" aria-label="TikTok"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-2.88 2.5 2.89 2.89 0 0 1 0-5.78 2.92 2.92 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 3 15.57 6.33 6.33 0 0 0 9.37 22a6.33 6.33 0 0 0 6.33-6.33V9.18a8.16 8.16 0 0 0 3.89.98V6.73a4.85 4.85 0 0 1-.01-.04z"/></svg></a>
            <a href="https://fukurakupet.stores.jp/" target="_blank" rel="noopener" class="sns-icon" aria-label="Shop"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg></a>
          </div>
        </div>
        <div class="footer-links">
          <h4 data-i18n="footer.navTitle">ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³</h4>
          <a href="/index.html#about" data-i18n="nav.about">çŒ«èˆã«ã¤ã„ã¦</a>
          <a href="/siberian.html" data-i18n="nav.siberian">ã‚µã‚¤ãƒ™ãƒªã‚¢ãƒ³ã®é­…åŠ›</a>
          <a href="/index.html#kittens" data-i18n="nav.kittens">å­çŒ«ä¸€è¦§</a>
          <a href="/index.html#parents" data-i18n="nav.parents">è¦ªçŒ«ç´¹ä»‹</a>
          <a href="/about.html" data-i18n="nav.aboutPage">å—è³æ­´ãƒ»èªå®š</a>
          <a href="/guide/" data-i18n="nav.guide">ãŠè¿ãˆã‚¬ã‚¤ãƒ‰</a>
          <a href="/blog.html" data-i18n="nav.blog">çŸ¥è­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</a>
          <a href="/kittens.html" data-i18n="nav.allKittens">å­çŒ«ä¸€è¦§ï¼ˆã™ã¹ã¦ï¼‰</a>
          <a href="/parents.html" data-i18n="nav.allParents">è¦ªçŒ«ç´¹ä»‹ï¼ˆã™ã¹ã¦ï¼‰</a>
          <a href="/gallery.html" data-i18n="nav.gallery">å’æ¥­çŒ«ã‚®ãƒ£ãƒ©ãƒªãƒ¼</a>
          <a href="/reviews.html" data-i18n="nav.reviews">ãŠå®¢æ§˜ã®å£°</a>
          <a href="https://catnamegive.mouxue56.workers.dev" target="_blank" rel="noopener" data-i18n="nav.naming">å­çŒ«ã®åå‰ãƒ„ãƒ¼ãƒ«</a>
          <a href="/index.html#visit" data-i18n="nav.visit">è¦‹å­¦æ¡ˆå†…</a>
        </div>
        <div class="footer-legal">
          <h4>å‹•ç‰©å–æ‰±æ¥­è¡¨ç¤º</h4>
          <div class="legal-box">
            <p><strong>ç¦æ¥½ã‚­ãƒ£ãƒƒãƒ†ãƒªãƒ¼ï¼ˆç¬¬ä¸€ç¨®å‹•ç‰©å–æ‰±æ¥­ï¼‰</strong></p>
            <p>ç¦æ¥½æ ªå¼ä¼šç¤¾ ä»£è¡¨å–ç· å½¹ ç¾… æ–¹é </p>
            <p>ç™»éŒ²ç•ªå·: 220012A / æœ‰åŠ¹æœŸé™: ~2027å¹´4æœˆ26æ—¥</p>
            <p>æ‰€åœ¨åœ°: å¤§é˜ªåºœå¤§é˜ªå¸‚åŸæ±åŒºæ±ä¸­æµœ 6-10-7</p>
          </div>
          <div class="legal-box">
            <p><strong>Fulluck Kittyï¼ˆç¬¬ä¸€ç¨®å‹•ç‰©å–æ‰±æ¥­ï¼‰</strong></p>
            <p>ä»£è¡¨: åˆ˜ æšæ£‰</p>
            <p>ç™»éŒ²ç•ªå·: 240051A / æœ‰åŠ¹æœŸé™: ~2029å¹´7æœˆ16æ—¥</p>
            <p>æ‰€åœ¨åœ°: å¤§é˜ªå¸‚åŸæ±åŒºæ±ä¸­æµœ 2-6-23</p>
          </div>
          <div class="law-notice-compact">
            <div class="law-notice-title">ğŸ“‹ å‹•ç‰©æ„›è­·ç®¡ç†æ³•ã«åŸºã¥ãå¯¾é¢è²©å£²</div>
            <p>æ³•å¾‹ã®è¦å®šã«ã‚ˆã‚Šã€ã”è³¼å…¥å‰ã«å¯¾é¢ã§ã®èª¬æ˜ã¨ç¾ç‰©ç¢ºèªãŒå¿…è¦ã§ã™ã€‚</p>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 ã‚µã‚¤ãƒ™ãƒªã‚¢ãƒ³ï½œå¤§é˜ªãƒ»ç¦æ¥½ã‚­ãƒ£ãƒƒãƒ†ãƒªãƒ¼ï¼ˆç¦æ¥½æ ªå¼ä¼šç¤¾ï¼‰All Rights Reserved.</p>
      </div>
    </div>
  </footer>

  <!-- ========== FIXED LINE BUTTON ========== -->
  <a href="https://page.line.me/915hnnlk?oat__id=5765672&openQrModal=true" class="fixed-line" aria-label="LINEã§ãŠå•ã„åˆã‚ã›" id="fixedLine" target="_blank" rel="noopener">
    <span class="fixed-line-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="white"><path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596a.626.626 0 0 1-.199.031c-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.271.173-.508.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/></svg></span>
    <span class="fixed-line-content"><span class="fixed-line-label">è¦‹å­¦äºˆç´„ãƒ»ã”ç›¸è«‡</span><span class="fixed-line-cta">LINEã§ç›¸è«‡ ğŸ¾</span></span>
  </a>

  <button class="back-to-top" id="backToTop" aria-label="ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã¸æˆ»ã‚‹">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg>
  </button>

  <script src="/i18n.js?v=20260214b"></script>
  <script src="/script.js?v=20260214"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script>
  // ===== Story Card V2: Conversational Wizard =====
  (function() {
    var API = 'https://fuluck-api.mouxue56.workers.dev';
    var currentStep = 0; // 0=welcome
    var formData = { photo: null, photoSmall: null, aiAnalysis: null, name: '', gender: '', color: '', date: '', pets: [], traits: [], story: '' };
    var generatedText = null;
    var currentCardLang = 'ja';

    // --- Color options ---
    var COLOR_OPTIONS = [
      { value: 'ãƒ–ãƒ©ã‚¦ãƒ³ã‚¿ãƒ“ãƒ¼', emoji: 'ğŸ¤', key: 'story.colorBrownTabby' },
      { value: 'ã‚·ãƒ«ãƒãƒ¼ã‚¿ãƒ“ãƒ¼', emoji: 'ğŸ©¶', key: 'story.colorSilverTabby' },
      { value: 'ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ãƒ“ãƒ¼', emoji: 'ğŸŸ¡', key: 'story.colorGoldenTabby' },
      { value: 'ãƒ–ãƒ«ãƒ¼', emoji: 'ğŸ©µ', key: 'story.colorBlue' },
      { value: 'ãƒ›ãƒ¯ã‚¤ãƒˆ', emoji: 'ğŸ¤', key: 'story.colorWhite' },
      { value: 'ã‚¯ãƒªãƒ¼ãƒ ', emoji: 'ğŸ§¡', key: 'story.colorCream' },
      { value: 'ãƒ¬ãƒƒãƒ‰', emoji: 'â¤ï¸', key: 'story.colorRed' },
      { value: 'ãƒ–ãƒ©ãƒƒã‚¯', emoji: 'ğŸ–¤', key: 'story.colorBlack' },
      { value: 'ãƒãƒ´ã‚¡ãƒã‚¹ã‚«ãƒ¬ãƒ¼ãƒ‰', emoji: 'ğŸ©·', key: 'story.colorNeva' },
      { value: 'ãã®ä»–', emoji: 'ğŸ¾', key: 'story.colorOther' },
    ];

    // --- Pet options ---
    var PET_OPTIONS = [
      { value: 'å…ˆä½çŒ«1åŒ¹', emoji: 'ğŸ±', key: 'story.pet1Cat' },
      { value: 'å…ˆä½çŒ«2åŒ¹+', emoji: 'ğŸ±ğŸ±', key: 'story.pet2Cats' },
      { value: 'çŠ¬', emoji: 'ğŸ¶', key: 'story.petDog' },
      { value: 'ã†ã•ã', emoji: 'ğŸ°', key: 'story.petRabbit' },
      { value: 'ãƒãƒ ã‚¹ã‚¿ãƒ¼', emoji: 'ğŸ¹', key: 'story.petHamster' },
      { value: 'é³¥', emoji: 'ğŸ¦', key: 'story.petBird' },
      { value: 'ãã®ä»–', emoji: 'ğŸ¾', key: 'story.petOther' },
      { value: 'ã„ãªã„', emoji: 'ğŸ ', key: 'story.petNone' },
    ];

    // --- Default trait options ---
    var DEFAULT_TRAITS = ['ç”˜ãˆã‚“åŠ', 'å¥½å¥‡å¿ƒæ—ºç››', 'ãŠã£ã¨ã‚Š', 'ã‚„ã‚“ã¡ã‚ƒ', 'äººæ‡ã£ã“ã„', 'ãƒã‚¤ãƒšãƒ¼ã‚¹', 'å…ƒæ°—ã„ã£ã±ã„', 'ç©ã‚„ã‹'];

    // --- Screen management ---
    function showScreen(name) {
      ['welcome', 'wizard', 'loading', 'result'].forEach(function(s) {
        var el = document.getElementById('screen-' + s);
        if (el) {
          if (s === name) { el.classList.add('visible'); el.style.display = ''; }
          else { el.classList.remove('visible'); if (s === 'loading' || s === 'result') el.style.display = 'none'; }
        }
      });
      var progBar = document.getElementById('progressBar');
      if (name === 'wizard') {
        progBar.classList.add('visible');
        document.getElementById('screen-welcome').style.display = 'none';
      } else {
        progBar.classList.remove('visible');
        if (name === 'welcome') document.getElementById('screen-welcome').style.display = '';
      }
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function goToStep(step) {
      currentStep = step;
      // Update panels
      for (var i = 1; i <= 5; i++) {
        var panel = document.getElementById('step-' + i);
        if (panel) panel.classList.toggle('active', i === step);
      }
      // Update progress dots
      var dots = document.querySelectorAll('.prog-dot');
      var lines = document.querySelectorAll('.prog-line');
      dots.forEach(function(dot, idx) {
        var s = idx + 1;
        dot.classList.toggle('active', s === step);
        dot.classList.toggle('done', s < step);
        if (s < step) dot.textContent = 'âœ“';
        else dot.textContent = s;
      });
      lines.forEach(function(line, idx) {
        line.classList.toggle('done', idx + 1 < step);
      });
      // Update dynamic prompts
      updateDynamicPrompts();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function updateDynamicPrompts() {
      var name = formData.name || '';
      var suffix = formData.gender === 'å¥³ã®å­' ? 'ã¡ã‚ƒã‚“' : formData.gender === 'ç”·ã®å­' ? 'ãã‚“' : 'ã¡ã‚ƒã‚“';
      var nameDisplay = name ? name + suffix : '';
      // Step 3 prompt
      var s3 = document.getElementById('step3Prompt');
      if (s3 && nameDisplay) s3.textContent = nameDisplay + 'ã®æ¯›è‰²ã‚’ç¢ºèªã—ã¦ã­ ğŸ¨';
      // Step 4 prompt
      var s4 = document.getElementById('step4Prompt');
      if (s4 && nameDisplay) s4.textContent = nameDisplay + 'ã«ã¯å…„å¼ŸãŒã„ã‚‹ï¼Ÿ ğŸ ';
      // Step 5 prompt
      var s5 = document.getElementById('step5Prompt');
      if (s5 && nameDisplay) s5.textContent = 'æœ€å¾Œã«ã€' + nameDisplay + 'ã®æ€§æ ¼ã‚„ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚’æ•™ãˆã¦ ğŸ’•';
    }

    // --- Populate color grid ---
    function buildColorGrid() {
      var grid = document.getElementById('colorGrid');
      grid.innerHTML = '';
      COLOR_OPTIONS.forEach(function(opt) {
        var chip = document.createElement('div');
        chip.className = 'color-chip';
        chip.dataset.value = opt.value;
        chip.innerHTML = '<span class="color-chip-emoji">' + opt.emoji + '</span><span data-i18n="' + opt.key + '">' + opt.value + '</span>';
        chip.addEventListener('click', function() { selectColor(opt.value); });
        grid.appendChild(chip);
      });
    }
    buildColorGrid();

    function selectColor(value) {
      formData.color = value;
      document.querySelectorAll('.color-chip').forEach(function(c) {
        c.classList.toggle('selected', c.dataset.value === value);
      });
      var customBox = document.getElementById('colorCustom');
      customBox.classList.toggle('visible', value === 'ãã®ä»–');
      updateStep3Btn();
    }

    function preselectColor(aiColor) {
      if (!aiColor) return;
      var matched = null;
      COLOR_OPTIONS.forEach(function(opt) {
        if (opt.value !== 'ãã®ä»–' && aiColor.indexOf(opt.value) !== -1) matched = opt.value;
      });
      // Try partial match
      if (!matched) {
        var keywords = { 'ãƒ–ãƒ©ã‚¦ãƒ³': 'ãƒ–ãƒ©ã‚¦ãƒ³ã‚¿ãƒ“ãƒ¼', 'ã‚·ãƒ«ãƒãƒ¼': 'ã‚·ãƒ«ãƒãƒ¼ã‚¿ãƒ“ãƒ¼', 'ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³': 'ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ãƒ“ãƒ¼', 'ãƒ–ãƒ«ãƒ¼': 'ãƒ–ãƒ«ãƒ¼', 'ç™½': 'ãƒ›ãƒ¯ã‚¤ãƒˆ', 'ãƒ›ãƒ¯ã‚¤ãƒˆ': 'ãƒ›ãƒ¯ã‚¤ãƒˆ', 'ã‚¯ãƒªãƒ¼ãƒ ': 'ã‚¯ãƒªãƒ¼ãƒ ', 'ãƒ¬ãƒƒãƒ‰': 'ãƒ¬ãƒƒãƒ‰', 'èµ¤': 'ãƒ¬ãƒƒãƒ‰', 'é»’': 'ãƒ–ãƒ©ãƒƒã‚¯', 'ãƒ–ãƒ©ãƒƒã‚¯': 'ãƒ–ãƒ©ãƒƒã‚¯', 'ãƒãƒ´ã‚¡': 'ãƒãƒ´ã‚¡ãƒã‚¹ã‚«ãƒ¬ãƒ¼ãƒ‰', 'ãƒã‚¤ãƒ³ãƒˆ': 'ãƒãƒ´ã‚¡ãƒã‚¹ã‚«ãƒ¬ãƒ¼ãƒ‰' };
        Object.keys(keywords).forEach(function(kw) {
          if (!matched && aiColor.indexOf(kw) !== -1) matched = keywords[kw];
        });
      }
      if (matched) {
        selectColor(matched);
        // Mark as AI-suggested
        document.querySelectorAll('.color-chip').forEach(function(c) {
          if (c.dataset.value === matched) c.classList.add('ai-suggested');
        });
      }
    }

    function updateStep3Btn() {
      var btn = document.getElementById('step3Next');
      var hasColor = formData.color && (formData.color !== 'ãã®ä»–' || document.getElementById('colorCustomInput').value.trim());
      btn.disabled = !hasColor;
    }

    // Color custom input listener
    document.getElementById('colorCustomInput').addEventListener('input', updateStep3Btn);

    // --- Populate pet grid ---
    function buildPetGrid() {
      var grid = document.getElementById('petGrid');
      grid.innerHTML = '';
      PET_OPTIONS.forEach(function(opt) {
        var card = document.createElement('div');
        card.className = 'pet-card';
        card.dataset.value = opt.value;
        card.innerHTML = '<span class="check-badge">âœ“</span><span class="pet-card-emoji">' + opt.emoji + '</span><span class="pet-card-label" data-i18n="' + opt.key + '">' + opt.value + '</span>';
        card.addEventListener('click', function() { togglePet(opt.value); });
        grid.appendChild(card);
      });
    }
    buildPetGrid();

    function togglePet(value) {
      if (value === 'ã„ãªã„') {
        formData.pets = ['ã„ãªã„'];
      } else {
        var idx = formData.pets.indexOf(value);
        // Remove 'ã„ãªã„' if selecting a pet
        var noneIdx = formData.pets.indexOf('ã„ãªã„');
        if (noneIdx !== -1) formData.pets.splice(noneIdx, 1);
        if (idx === -1) formData.pets.push(value);
        else formData.pets.splice(idx, 1);
      }
      // Update UI
      document.querySelectorAll('.pet-card').forEach(function(c) {
        c.classList.toggle('selected', formData.pets.indexOf(c.dataset.value) !== -1);
      });
    }

    // --- Trait chips ---
    function buildTraitChips(aiTraits) {
      var container = document.getElementById('traitChips');
      container.innerHTML = '';
      // Merge AI traits with defaults, deduplicate
      var allTraits = (aiTraits || []).concat(DEFAULT_TRAITS);
      var seen = {};
      var unique = [];
      allTraits.forEach(function(t) {
        if (!seen[t]) { seen[t] = true; unique.push(t); }
      });
      unique = unique.slice(0, 10); // Limit to 10
      formData.traits = (aiTraits || []).slice(); // Pre-select AI traits

      unique.forEach(function(trait) {
        var chip = document.createElement('div');
        chip.className = 'trait-chip';
        chip.textContent = trait;
        chip.dataset.value = trait;
        if (formData.traits.indexOf(trait) !== -1) {
          chip.classList.add('selected', 'ai-suggested');
        }
        chip.addEventListener('click', function() {
          var idx = formData.traits.indexOf(trait);
          if (idx === -1) { formData.traits.push(trait); chip.classList.add('selected'); }
          else { formData.traits.splice(idx, 1); chip.classList.remove('selected'); }
        });
        container.appendChild(chip);
      });
    }
    buildTraitChips([]);

    // --- Photo Upload ---
    var photoArea = document.getElementById('photoArea');
    var photoInput = document.getElementById('photoInput');
    var photoPreview = document.getElementById('photoPreview');

    photoArea.addEventListener('click', function() { photoInput.click(); });
    photoArea.addEventListener('dragover', function(e) { e.preventDefault(); photoArea.style.borderColor = 'var(--story-accent)'; });
    photoArea.addEventListener('dragleave', function() { if (!formData.photo) photoArea.style.borderColor = ''; });
    photoArea.addEventListener('drop', function(e) { e.preventDefault(); if (e.dataTransfer.files.length) handlePhoto(e.dataTransfer.files[0]); });
    photoInput.addEventListener('change', function() { if (this.files.length) handlePhoto(this.files[0]); });

    function handlePhoto(file) {
      var validTypes = ['image/jpeg', 'image/png', 'image/webp'];
      if (validTypes.indexOf(file.type) === -1) { alert('JPG, PNG, WebP ã®ã¿å¯¾å¿œ'); return; }
      if (file.size > 10 * 1024 * 1024) { alert('10MBä»¥ä¸‹ã®ç”»åƒã‚’é¸ã‚“ã§ãã ã•ã„'); return; }

      var reader = new FileReader();
      reader.onload = function(e) {
        // Full-size for card (max 2000px)
        resizeImage(e.target.result, 2000, function(fullUrl) {
          formData.photo = fullUrl;
          photoPreview.src = fullUrl;
          photoArea.classList.add('has-photo');

          // Small version for AI analysis (max 800px)
          resizeImage(e.target.result, 800, function(smallUrl) {
            formData.photoSmall = smallUrl;
            analyzePhoto(smallUrl);
          });
        });
      };
      reader.readAsDataURL(file);
    }

    function resizeImage(dataUrl, maxWidth, callback) {
      var img = new Image();
      img.onload = function() {
        if (img.width <= maxWidth) { callback(dataUrl); return; }
        var canvas = document.createElement('canvas');
        var ratio = maxWidth / img.width;
        canvas.width = maxWidth;
        canvas.height = img.height * ratio;
        var ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        callback(canvas.toDataURL('image/jpeg', 0.85));
      };
      img.src = dataUrl;
    }

    // --- AI Photo Analysis ---
    function analyzePhoto(base64Uri) {
      var box = document.getElementById('aiAnalysisBox');
      var loading = document.getElementById('aiLoading');
      var chips = document.getElementById('aiResultChips');

      box.classList.add('visible');
      loading.style.display = '';
      chips.classList.remove('visible');
      chips.innerHTML = '';
      document.getElementById('step1Next').disabled = true;

      fetch(API + '/api/story/analyze-photo', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ image: base64Uri })
      })
      .then(function(r) { return r.json(); })
      .then(function(data) {
        loading.style.display = 'none';
        if (data.error) throw new Error(data.error);

        formData.aiAnalysis = data;
        // Show result chips
        if (data.color) {
          var c = document.createElement('span');
          c.className = 'ai-chip ai-chip-color';
          c.textContent = 'æ¯›è‰²: ' + data.color;
          chips.appendChild(c);
        }
        if (data.traits && data.traits.length) {
          data.traits.forEach(function(t) {
            var c = document.createElement('span');
            c.className = 'ai-chip ai-chip-trait';
            c.textContent = t;
            chips.appendChild(c);
          });
        }
        chips.classList.add('visible');
        document.getElementById('step1Next').disabled = false;
      })
      .catch(function(err) {
        console.error('AI analysis error:', err);
        loading.style.display = 'none';
        // Allow proceeding even if AI fails
        formData.aiAnalysis = null;
        document.getElementById('step1Next').disabled = false;
      });
    }

    // --- Default date ---
    var dateInput = document.getElementById('catDate');
    if (dateInput) dateInput.value = new Date().toISOString().split('T')[0];

    // --- Placeholder i18n ---
    function updatePlaceholders() {
      var lang = 'ja';
      try { lang = localStorage.getItem('fuluckpet-lang') || 'ja'; } catch(e) {}
      document.querySelectorAll('[data-placeholder-' + lang + ']').forEach(function(el) {
        el.placeholder = el.getAttribute('data-placeholder-' + lang);
      });
    }
    updatePlaceholders();
    window.addEventListener('langChanged', updatePlaceholders);

    // --- Navigation Events ---
    document.getElementById('startBtn').addEventListener('click', function() {
      showScreen('wizard');
      goToStep(1);
    });

    // Step 1 â†’ 2
    document.getElementById('step1Next').addEventListener('click', function() {
      if (!formData.photo) return;
      goToStep(2);
      // Personalize step 2 prompt with AI color
      if (formData.aiAnalysis && formData.aiAnalysis.color) {
        var p = document.getElementById('step2Prompt');
        p.textContent = formData.aiAnalysis.color + 'ã®ç´ æ•µãªå­ï¼åå‰ã‚’æ•™ãˆã¦ ğŸ±';
      }
    });

    // Step 2 â†’ 3
    document.getElementById('step2Next').addEventListener('click', function() {
      formData.name = document.getElementById('catName').value.trim();
      if (!formData.name || !formData.gender) return;

      goToStep(3);
      // Pre-select AI color
      if (formData.aiAnalysis && formData.aiAnalysis.color) {
        preselectColor(formData.aiAnalysis.color);
      }
    });

    // Name + Gender validation
    var nameInput = document.getElementById('catName');
    nameInput.addEventListener('input', function() {
      formData.name = this.value.trim();
      checkStep2();
    });

    document.querySelectorAll('.gender-card').forEach(function(card) {
      card.addEventListener('click', function() {
        formData.gender = this.dataset.value;
        document.querySelectorAll('.gender-card').forEach(function(c) {
          c.classList.toggle('selected', c.dataset.value === formData.gender);
        });
        checkStep2();
      });
    });

    function checkStep2() {
      document.getElementById('step2Next').disabled = !(formData.name && formData.gender);
    }

    // Step 3 â†’ 4
    document.getElementById('step3Next').addEventListener('click', function() {
      if (formData.color === 'ãã®ä»–') {
        formData.color = document.getElementById('colorCustomInput').value.trim() || 'ãã®ä»–';
      }
      formData.date = document.getElementById('catDate').value;
      goToStep(4);
    });

    // Step 4 â†’ 5
    document.getElementById('step4Next').addEventListener('click', function() {
      goToStep(5);
      // Build trait chips with AI traits
      var aiTraits = (formData.aiAnalysis && formData.aiAnalysis.traits) || [];
      buildTraitChips(aiTraits);
    });

    // Back buttons
    document.querySelectorAll('[data-back]').forEach(function(btn) {
      btn.addEventListener('click', function() {
        if (currentStep > 1) goToStep(currentStep - 1);
      });
    });

    // Skip buttons
    document.querySelectorAll('[data-skip]').forEach(function(btn) {
      btn.addEventListener('click', function() {
        var target = parseInt(btn.dataset.skip);
        goToStep(target);
        if (target === 5) {
          var aiTraits = (formData.aiAnalysis && formData.aiAnalysis.traits) || [];
          buildTraitChips(aiTraits);
        }
      });
    });

    // --- Generate ---
    function doGenerate() {
      formData.story = document.getElementById('catStory').value.trim();

      var petsText = formData.pets.filter(function(p) { return p !== 'ã„ãªã„'; }).join('ã€');
      var traitsText = formData.traits.join('ã€');

      var payload = {
        name: formData.name,
        gender: formData.gender,
        color: formData.color,
        date: formData.date,
        personality: traitsText || (formData.aiAnalysis && formData.aiAnalysis.traits ? formData.aiAnalysis.traits.join('ã€') : ''),
        nameReason: '',
        happyMoment: formData.story,
        otherPets: petsText || 'ã„ãªã„',
        message: ''
      };

      showScreen('loading');

      fetch(API + '/api/story/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      })
      .then(function(r) {
        if (!r.ok) throw new Error('API error: ' + r.status);
        return r.json();
      })
      .then(function(data) {
        if (data.error) throw new Error(data.error);
        generatedText = data;
        currentCardLang = data.ja ? 'ja' : 'zh';
        renderResult();
        showScreen('result');

        if (typeof gtag === 'function') {
          gtag('event', 'story_generate', { event_category: 'story', event_label: formData.name });
        }
      })
      .catch(function(err) {
        console.error('Story generation error:', err);
        showScreen('wizard');
        goToStep(5);
        var errorEl = document.getElementById('wizardError');
        errorEl.textContent = 'ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚';
        errorEl.style.display = 'block';
        setTimeout(function() { errorEl.style.display = 'none'; }, 5000);
      });
    }

    document.getElementById('generateBtn').addEventListener('click', doGenerate);
    document.getElementById('skipGenBtn').addEventListener('click', doGenerate);

    // --- Render Result (same logic as V1) ---
    function renderResult() {
      document.querySelectorAll('.card-lang-tab').forEach(function(tab) {
        tab.classList.toggle('active', tab.dataset.lang === currentCardLang);
      });
      var tabContainer = document.querySelector('.card-lang-tabs');
      tabContainer.style.display = (generatedText.ja && generatedText.zh) ? '' : 'none';
      renderCardForLang(currentCardLang);
    }

    function renderCardForLang(lang) {
      var text = lang === 'ja' ? generatedText.ja : generatedText.zh;
      if (!text) { text = generatedText.ja || generatedText.zh; lang = generatedText.ja ? 'ja' : 'zh'; }

      var shortText = text.short || '';
      var longText = lang === 'ja' ? (text.instagram || '') : (text.xiaohongshu || '');
      var catName = formData.name;
      var catDate = formData.date;

      var dateStr = catDate;
      try {
        var d = new Date(catDate + 'T00:00:00');
        dateStr = d.getFullYear() + 'å¹´' + (d.getMonth() + 1) + 'æœˆ' + d.getDate() + 'æ—¥' + (lang === 'ja' ? ' ãŠè¿ãˆ' : ' è¿æ¥çºªå¿µ');
      } catch(e) {}

      // Hidden card for download
      document.getElementById('cardPhoto').style.backgroundImage = 'url(' + formData.photo + ')';
      document.getElementById('cardName').textContent = catName;
      document.getElementById('cardText').textContent = shortText;
      document.getElementById('cardDate').textContent = dateStr;

      // Visible preview
      var previewEl = document.getElementById('card-preview');
      var canvasEl = document.getElementById('card-canvas');
      previewEl.innerHTML = canvasEl.innerHTML;
      previewEl.style.cssText = canvasEl.style.cssText;
      previewEl.style.position = 'relative';
      previewEl.style.left = '0';

      var previewPhoto = previewEl.querySelector('.card-photo');
      if (previewPhoto) previewPhoto.style.backgroundImage = 'url(' + formData.photo + ')';
      var previewName = previewEl.querySelector('.card-cat-name');
      if (previewName) previewName.textContent = catName;
      var previewText = previewEl.querySelector('.card-ai-text');
      if (previewText) previewText.textContent = shortText;
      var previewDate = previewEl.querySelector('.card-date');
      if (previewDate) previewDate.textContent = dateStr;

      var wrapper = document.querySelector('.card-preview-wrapper');
      if (wrapper) {
        var scale = wrapper.offsetWidth / 1080;
        wrapper.style.setProperty('--preview-scale', scale);
        wrapper.style.height = (1440 * scale) + 'px';
      }

      document.getElementById('copyText').textContent = longText;
      document.getElementById('textLabel').textContent = lang === 'ja' ? 'Instagram / SNS' : 'å°çº¢ä¹¦ / æœ‹å‹åœˆ';
    }

    // Tab switching
    document.querySelectorAll('.card-lang-tab').forEach(function(tab) {
      tab.addEventListener('click', function() {
        currentCardLang = this.dataset.lang;
        renderResult();
      });
    });

    // --- Download ---
    document.getElementById('downloadBtn').addEventListener('click', function() {
      var btn = this;
      btn.disabled = true;
      btn.style.opacity = '0.6';

      document.fonts.ready.then(function() {
        setTimeout(function() {
          var canvasEl = document.getElementById('card-canvas');
          canvasEl.style.left = '0';
          canvasEl.style.position = 'fixed';
          canvasEl.style.top = '0';
          canvasEl.style.zIndex = '-1';

          html2canvas(canvasEl, {
            width: 1080, height: 1440, scale: 1,
            useCORS: true, allowTaint: true,
            backgroundColor: '#FFFAF5', logging: false
          }).then(function(canvas) {
            canvasEl.style.left = '-9999px';
            canvasEl.style.position = 'absolute';
            canvasEl.style.zIndex = '';

            var link = document.createElement('a');
            link.download = 'fuluckpet-story-' + Date.now() + '.png';
            link.href = canvas.toDataURL('image/png');
            link.click();

            btn.disabled = false;
            btn.style.opacity = '';
            if (typeof gtag === 'function') gtag('event', 'story_download', { event_category: 'story' });
          }).catch(function(err) {
            console.error('html2canvas error:', err);
            canvasEl.style.left = '-9999px';
            canvasEl.style.position = 'absolute';
            canvasEl.style.zIndex = '';
            btn.disabled = false;
            btn.style.opacity = '';
          });
        }, 500);
      });
    });

    // --- Copy ---
    document.getElementById('copyBtn').addEventListener('click', function() {
      var btn = this;
      var text = document.getElementById('copyText').textContent;
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(function() { showCopied(btn); }).catch(function() { fallbackCopy(text, btn); });
      } else { fallbackCopy(text, btn); }
      if (typeof gtag === 'function') gtag('event', 'story_copy', { event_category: 'story' });
    });

    function fallbackCopy(text, btn) {
      var ta = document.createElement('textarea');
      ta.value = text;
      ta.style.position = 'fixed';
      ta.style.left = '-9999px';
      document.body.appendChild(ta);
      ta.select();
      try { document.execCommand('copy'); showCopied(btn); } catch(e) {}
      document.body.removeChild(ta);
    }

    function showCopied(btn) {
      var span = btn.querySelector('span');
      var orig = span.textContent;
      span.textContent = 'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
      btn.style.borderColor = 'var(--story-accent)';
      btn.style.color = 'var(--story-accent)';
      setTimeout(function() { span.textContent = orig; btn.style.borderColor = ''; btn.style.color = ''; }, 2000);
    }

    // --- Retry ---
    document.getElementById('retryBtn').addEventListener('click', function() {
      generatedText = null;
      currentCardLang = 'ja';
      formData = { photo: null, photoSmall: null, aiAnalysis: null, name: '', gender: '', color: '', date: '', pets: [], traits: [], story: '' };
      // Reset UI
      photoArea.classList.remove('has-photo');
      photoPreview.src = '';
      document.getElementById('aiAnalysisBox').classList.remove('visible');
      document.getElementById('catName').value = '';
      document.querySelectorAll('.gender-card').forEach(function(c) { c.classList.remove('selected'); });
      document.querySelectorAll('.color-chip').forEach(function(c) { c.classList.remove('selected', 'ai-suggested'); });
      document.getElementById('colorCustom').classList.remove('visible');
      document.querySelectorAll('.pet-card').forEach(function(c) { c.classList.remove('selected'); });
      document.getElementById('catStory').value = '';
      dateInput.value = new Date().toISOString().split('T')[0];
      document.getElementById('step1Next').disabled = true;
      document.getElementById('step2Next').disabled = true;
      document.getElementById('step3Next').disabled = true;

      showScreen('wizard');
      goToStep(1);
    });

    // --- Resize preview on window resize ---
    window.addEventListener('resize', function() {
      if (generatedText) {
        var wrapper = document.querySelector('.card-preview-wrapper');
        if (wrapper) {
          var scale = wrapper.offsetWidth / 1080;
          wrapper.style.setProperty('--preview-scale', scale);
          wrapper.style.height = (1440 * scale) + 'px';
        }
      }
    });
  })();
  </script>
</body>
</html>
